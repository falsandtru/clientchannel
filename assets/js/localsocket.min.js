/*! localsocket v0.0.6 https://github.com/falsandtru/localsocket | (c) 2015, falsandtru | MIT License (https://opensource.org/licenses/MIT) */
define="function"==typeof define&&define.amd?define:function(){"use strict";var e="localsocket",t={};return function r(n,o,i){return i?void i.apply(this,o.map(function(e){switch(e){case"require":return"function"==typeof require?require:void 0;case"exports":return-1===n.indexOf("/")?t[n]="undefined"==typeof exports?self[n]=self[n]||{}:exports:t[n]=t.hasOwnProperty(n)?t[n]:{};default:return".d"===e.slice(-2)&&{}||t.hasOwnProperty(e)&&t[e]||"function"==typeof require&&require(e)||self[e]}})):void r(e,n,o)}}();var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)};define("src/layer/infrastructure/indexeddb/module/global",["require","exports"],function(e,t){"use strict";t.indexedDB=self.indexedDB||self.webkitIndexedDB||self.mozIndexedDB||self.msIndexedDB;var r=self.IDBKeyRange||self.webkitIDBKeyRange||self.mozIDBKeyRange||self.msIDBKeyRange;t.IDBKeyRange=r;var n;!function(e){e.readonly="readonly",e.readwrite="readwrite"}(n=t.IDBTransaction||(t.IDBTransaction={}));var o;!function(e){e.next="next",e.nextunique="nextunique",e.prev="prev",e.prevunique="prevunique"}(o=t.IDBCursorDirection||(t.IDBCursorDirection={}))}),define("src/layer/infrastructure/indexeddb/model/event",["require","exports"],function(e,t){"use strict";!function(e){e[e.connect=0]="connect",e[e.disconnect=1]="disconnect",e[e.block=2]="block",e[e.error=3]="error",e[e.abort=4]="abort",e[e.crash=5]="crash",e[e.destroy=6]="destroy"}(t.IDBEvenTypes||(t.IDBEvenTypes={}));var r,n=t.IDBEvenTypes;!function(e){e.connect=n[n.connect],e.disconnect=n[n.disconnect],e.block=n[n.block],e.error=n[n.error],e.abort=n[n.abort],e.crash=n[n.crash],e.destroy=n[n.destroy]}(r=t.IDBEventName||(t.IDBEventName={}));var o=function(){function e(e,t){this.name=t,this.namespace=[this.name],this.type=n[e],void Object.freeze(this)}return e}();t.IDBEvent=o}),define("src/layer/infrastructure/webstorage/module/global",["require","exports","arch-stream"],function(e,t,r){"use strict";t.supportWebStorage=function(){try{var e="localsocket#"+r.uuid();if(void self.sessionStorage.setItem(e,e),e!==self.sessionStorage.getItem(e))throw 1;return void self.sessionStorage.removeItem(e),!0}catch(t){return!1}}(),t.localStorage=t.supportWebStorage?self.localStorage:void 0,t.sessionStorage=t.supportWebStorage?self.sessionStorage:void 0}),define("src/layer/infrastructure/webstorage/model/event",["require","exports","arch-stream","src/layer/infrastructure/webstorage/module/global"],function(e,t,r,n){"use strict";var o={localStorage:new r.Observable,sessionStorage:new r.Observable};t.events=o,void window.addEventListener("storage",function(e){switch(e.storageArea){case n.localStorage:return void o.localStorage.emit(["storage"],e);case n.sessionStorage:return void o.sessionStorage.emit(["storage"],e)}})}),define("src/layer/infrastructure/webstorage/api",["require","exports","src/layer/infrastructure/webstorage/module/global","src/layer/infrastructure/webstorage/model/event"],function(e,t,r,n){"use strict";t.localStorage=r.localStorage,t.sessionStorage=r.sessionStorage,t.supportWebStorage=r.supportWebStorage,t.events=n.events}),define("src/layer/infrastructure/indexeddb/model/access",["require","exports","arch-stream","src/layer/infrastructure/indexeddb/module/global","src/layer/infrastructure/indexeddb/model/event","src/layer/infrastructure/webstorage/api"],function(e,t,r,n,o,i){"use strict";function s(e,r){void w.set(e,0),void t.ConfigMap.set(e,r),k.has(e)||(void k.add(e,void 0),void v(e))}function a(e){return function(t){var r=x.get(e)||x.add(e,[]);void r.push(t),void u(e)}}function c(e){return void w.set(e,1),void t.ConfigMap.set(e,{make:function(){return!1},verify:function(){return!1},destroy:function(){return!1}}),D.has(e)?D.get(e).end():void(k.has(e)||(void k.add(e,void 0),void v(e)))}function d(e){return void w.set(e,2),void t.ConfigMap.set(e,{make:function(){return!1},verify:function(){return!1},destroy:function(){return!0}}),D.has(e)?D.get(e).destroy():void(k.has(e)||(void k.add(e,void 0),void v(e)))}function u(e){if(!i.supportWebStorage)return void x["delete"](e);if(D.has(e)&&t.ConfigMap.has(e)){var r=D.get(e),n=x.get(e)||[];try{for(;r&&n.length>0&&0===w.get(e);)void n[0](r),void n.shift()}catch(o){o instanceof Error?void console.error(o,o+"",o.stack):void console.error(o),void m(e,o)}}}function v(e,r){void 0===r&&(r=0);t.ConfigMap.get(e);try{var o=r?n.indexedDB.open(e,r):n.indexedDB.open(e);o.onupgradeneeded=function(t){return void l(e,o)},o.onsuccess=function(t){return void y(e,o.result)},o.onblocked=function(t){return void f(e,o)},o.onerror=function(t){return void p(e,o.error,t)}}catch(i){void m(e,i)}}function f(e,t){void b.emit([e,o.IDBEvenTypes[o.IDBEvenTypes.block]],new o.IDBEvent(o.IDBEvenTypes.block,e))}function l(e,r){var n=r.result,o=t.ConfigMap.get(e),i=o.make,s=o.destroy;try{i(n)?(r.onsuccess=function(t){return void y(e,n)},r.onerror=function(t){return void p(e,r.error,t)}):r.onsuccess=r.onerror=function(t){void n.close(),s(r.error,t)?void g(e):void E(e)}}catch(a){void m(e,a)}}function y(e,r){switch(r.onversionchange=function(e){return void r.close()},r.end=function(){void D["delete"](e),void r.close(),void E(e)},r.destroy=function(){void D["delete"](e),void r.close(),void g(e)},r.onerror=function(t){void D["delete"](e),void p(e,t.target.error,t)},r.onabort=function(t){void D["delete"](e),void h(e,t.target.error,t)},w.get(e)){case 0:var n=t.ConfigMap.get(e).verify;try{if(!n(r))return void E(e,+r.version+1)}catch(i){return void m(e,i)}return void b.emit([e,o.IDBEvenTypes[o.IDBEvenTypes.connect]],new o.IDBEvent(o.IDBEvenTypes.connect,e)),void D.add(e,r),void u(e);case 1:return void r.end();case 2:return void r.destroy()}throw new TypeError("LocalSocket: Invalid command "+w.get(e)+".")}function p(e,r,n){void n.preventDefault(),void D["delete"](e),void b.emit([e,o.IDBEvenTypes[o.IDBEvenTypes.error]],new o.IDBEvent(o.IDBEvenTypes.error,e));var i=t.ConfigMap.get(e).destroy;return i(r,n)?void g(e):void E(e)}function h(e,r,n){void n.preventDefault(),void D["delete"](e),void b.emit([e,o.IDBEvenTypes[o.IDBEvenTypes.abort]],new o.IDBEvent(o.IDBEvenTypes.abort,e));var i=t.ConfigMap.get(e).destroy;return i(r,n)?void g(e):void E(e)}function m(e,r){void D["delete"](e),void b.emit([e,o.IDBEvenTypes[o.IDBEvenTypes.crash]],new o.IDBEvent(o.IDBEvenTypes.crash,e));var n=t.ConfigMap.get(e).destroy;return n(r,null)?void g(e):void E(e)}function g(e){void D["delete"](e);var t=n.indexedDB.deleteDatabase(e);t.onsuccess=function(t){return void x["delete"](e),void b.emit([e,o.IDBEvenTypes[o.IDBEvenTypes.destroy]],new o.IDBEvent(o.IDBEvenTypes.destroy,e)),void E(e)},t.onerror=function(r){void p(e,t.error,r)}}function E(e,r){switch(void 0===r&&(r=0),void D["delete"](e),void b.emit([e,o.IDBEvenTypes[o.IDBEvenTypes.disconnect]],new o.IDBEvent(o.IDBEvenTypes.disconnect,e)),w.get(e)){case 0:return void v(e,r);case 1:return void t.ConfigMap["delete"](e),void void k["delete"](e);case 2:return void t.ConfigMap["delete"](e),void void k["delete"](e)}throw new TypeError("LocalSocket: Invalid command "+w.get(e)+".")}var b=new r.Observable;t.event=b,t.ConfigMap=new r.Map;var S;!function(e){e[e.open=0]="open",e[e.close=1]="close",e[e.destroy=2]="destroy"}(S||(S={}));var w=new r.Map,x=new r.Set,k=new r.Set,D=new r.Set;t.open=s,t.listen=a,t.close=c,t.destroy=d}),define("src/layer/infrastructure/indexeddb/api",["require","exports","src/layer/infrastructure/indexeddb/module/global","src/layer/infrastructure/indexeddb/model/access","src/layer/infrastructure/indexeddb/model/event"],function(e,t,r,n,o){"use strict";t.indexedDB=r.indexedDB,t.IDBKeyRange=r.IDBKeyRange,t.IDBTransaction=r.IDBTransaction,t.IDBCursorDirection=r.IDBCursorDirection,t.open=n.open,t.listen=n.listen,t.close=n.close,t.destroy=n.destroy,t.event=n.event,t.IDBEvent=o.IDBEvent,t.IDBEventName=o.IDBEventName}),define("src/lib/noop",["require","exports"],function(e,t){"use strict";function r(){}t.noop=r}),define("src/layer/domain/dao/module/builder",["require","exports","arch-stream","src/lib/noop"],function(e,t,r,n){"use strict";function o(e,o,a){void 0===a&&(a=n.noop);var c=o();if(void Object.keys(t.SCHEMA).map(function(e){return t.SCHEMA[e].NAME}).reduce(function(e,t){delete c[t]},void 0),"string"!=typeof e[t.SCHEMA.KEY.NAME])throw new TypeError("LocalSocket: Invalid key: "+e[t.SCHEMA.KEY.NAME]);var d=r.assign(Object.keys(c).filter(i).filter(s(c)).reduce(function(t,r){var n=Object.getOwnPropertyDescriptor(c,r);if(n&&(n.get||n.set))return t;var o=c[r];return void 0===e[r]&&(e[r]=o),t[r]={configurable:!1,enumerable:!0,get:function(){return void 0===e[r]?o:e[r]},set:function(t){var n=e[r];t!==n&&(e[r]=void 0===t?o:t,void a(r,t,n))}},t},{}),(u={},u[t.SCHEMA.META.NAME]={configurable:!1,enumerable:!1,get:function(){return e[t.SCHEMA.META.NAME]}},u[t.SCHEMA.ID.NAME]={configurable:!1,enumerable:!1,get:function(){return e[t.SCHEMA.ID.NAME]}},u[t.SCHEMA.KEY.NAME]={configurable:!1,enumerable:!1,get:function(){return e[t.SCHEMA.KEY.NAME]}},u[t.SCHEMA.DATE.NAME]={configurable:!1,enumerable:!1,get:function(){return e[t.SCHEMA.DATE.NAME]}},u[t.SCHEMA.EVENT.NAME]={configurable:!1,enumerable:!1,get:function(){return e[t.SCHEMA.EVENT.NAME]}},u));return void Object.defineProperties(c,d),void Object.seal(c),c;var u}function i(e){return e.length>0&&"_"!==e[0]&&"_"!==e[e.length-1]&&a.test(e)}function s(e){return function(t){switch(typeof e[t]){case"undefined":case"boolean":case"number":case"string":case"object":return!0;default:return!1}}}t.SCHEMA={META:{NAME:"__meta"},ID:{NAME:"__id"},KEY:{NAME:"__key"},DATE:{NAME:"__date"},EVENT:{NAME:"__event"}},t.build=o;var a=/^[A-z_$][0-9A-z_$]*$/;t.isValidPropertyName=i,t.isValidPropertyValue=s}),define("src/layer/domain/dao/api",["require","exports","src/layer/domain/dao/module/builder"],function(e,t,r){"use strict";t.SCHEMA=r.SCHEMA,t.build=r.build,t.isValidPropertyName=r.isValidPropertyName,t.isValidPropertyValue=r.isValidPropertyValue}),define("src/layer/domain/indexeddb/model/types",["require","exports"],function(e,t){"use strict";function r(e){return+e}function n(e){return void 0!==e&&null!==e?e+"":""}t.IdNumber=r,t.KeyString=n}),define("src/layer/domain/lib/assign",["require","exports"],function(e,t){"use strict";function r(e){function t(e){function t(e){return e instanceof Object&&e.constructor.BYTES_PER_ELEMENT>0&&e.buffer instanceof ArrayBuffer}return!!e&&"object"==typeof e&&!t(e)&&e instanceof Blob==!1&&e instanceof ImageData==!1&&e instanceof ArrayBuffer==!1}for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];if(void 0===e||null===e)throw new TypeError("LocalSocket: assign: Cannot merge objects into "+e+".");for(var i=Object(e),s=0;s<n.length;s++){var a=n[s];if(void 0!==a&&null!==a){a=Object(a);for(var c=0,d=Object.keys(Object(a));c<d.length;c++){var u=d[c],v=Object.getOwnPropertyDescriptor(a,u);if(void 0!==v&&v.enumerable){var f=a[u];i[u];t(f)?i[u]=Array.isArray(f)?f.slice():r({},f):i[u]=f}}}}return i}t.assign=r}),define("src/layer/domain/indexeddb/model/store/event",["require","exports","arch-stream","src/layer/infrastructure/indexeddb/api","src/layer/domain/indexeddb/model/types","src/layer/domain/lib/assign","src/lib/noop"],function(e,t,r,n,o,i,s){"use strict";function a(e){function t(e){return e.map(function(e,t){return[e,t]}).sort(function(e,t){var r=e[0],n=e[1],o=t[0],i=t[1];return indexedDB.cmp(r.key,o.key)||o.date-r.date||i-n}).reduceRight(function(e,t){var n=e[0],o=e.slice(1),i=t[0],s=n[0];return s?s.key===i.key?r.concat([r.concat([i],n)],o):r.concat([[i]],r.concat([n],o)):[[i]]},[[]])}function n(e,t){switch(t.type){case c[c.put]:return void 0!==t.value[t.attr]?new v(t.key,i.assign(new d,e.value,t.value),c.snapshot):new v(t.key,Object.keys(e.value).reduce(function(r,n){return n===t.attr?r:(r[n]=e[n],r)},new d),c.snapshot);case c[c.snapshot]:return t;case c[c["delete"]]:return t}throw new TypeError("LocalSocket: Invalid event type: "+t.type)}return t(e).map(function(e){return e.reduceRight(n,new v(o.KeyString(""),new d,c["delete"],0))})}!function(e){e[e.put=0]="put",e[e["delete"]=1]="delete",e[e.snapshot=2]="snapshot"}(t.EventTypes||(t.EventTypes={}));var c=t.EventTypes,d=function(){function e(){}return e}();t.EventValue=d;var u=function(){function e(e,t,r,n,o){if("number"==typeof this.id&&this.id>0==!1||void 0!==this.id)throw new TypeError("LocalSocket: EventRecord: Invalid event id: "+this.id);if(this.type=c[o],"string"!=typeof this.type||void 0===c[this.type])throw new TypeError("LocalSocket: EventRecord: Invalid event type: "+this.type);if(this.key=t,"string"!=typeof this.key)throw new TypeError("LocalSocket: EventRecord: Invalid event key: "+this.key);if(this.value=r,"object"!=typeof this.value||!this.value)throw new TypeError("LocalSocket: EventRecord: Invalid event value: "+this.value);if(this.date=n,"number"!=typeof this.date||this.date>=0==!1)throw new TypeError("LocalSocket: EventRecord: Invalid event date: "+this.date);if(this.attr=this.type===c[c.put]?Object.keys(r).reduce(function(e,t){return t.length>0&&"_"!==t[0]&&"_"!==t[t.length-1]?t:e},""):"","string"!=typeof this.attr)throw new TypeError("LocalSocket: EventRecord: Invalid event attr: "+this.key);if(this.type===c[c.put]&&0===this.attr.length)throw new TypeError("LocalSocket: EventRecord: Invalid event attr with "+this.type+": "+this.attr);if(this.type!==c[c.put]&&0!==this.attr.length)throw new TypeError("LocalSocket: EventRecord: Invalid event attr with "+this.type+": "+this.attr);switch(o){case c.put:return this.value=r=i.assign(new d,(s={},s[this.attr]=r[this.attr],s)),void void Object.freeze(this.value);case c.snapshot:return this.value=r=i.assign(new d,r),void void Object.freeze(this.value);case c["delete"]:default:return this.value=r=new d,void void Object.freeze(this.value)}throw new TypeError("LocalSocket: Invalid event type: "+o);var s}return e}(),v=function(e){function t(t,r,n,o){if(void 0===n&&(n=c.put),void 0===o&&(o=Date.now()),e.call(this,void 0,t,r,o,n),void 0!==this.id||"id"in this)throw new TypeError("LocalSocket: UnsavedEventRecord: Invalid event id: "+this.id)}return __extends(t,e),t}(u);t.UnsavedEventRecord=v;var f=function(e){function t(t,r,n,o,i){if(e.call(this,t,r,n,i,o),this.id=t,this.id>0==!1)throw new TypeError("LocalSocket: SavedEventRecord: Invalid event id: "+this.id);void Object.freeze(this)}return __extends(t,e),t}(u);t.SavedEventRecord=f,t.ESEventTypes={put:"put","delete":"delete",snapshot:"snapshot",query:"query"};var l=function(){function e(e,t,r,n){this.type=e,this.id=t,this.key=r,this.attr=n,void Object.freeze(this)}return e}();t.ESEvent=l;var y={id:"id",key:"key",type:"type",attr:"attr",value:"value",date:"date",surrogateKeyDateField:"key+date"},p=function(){function e(e,t){var n=this;this.access=e,this.name=t,this.cache=new r.Supervisor,this.events={load:new r.Observable,save:new r.Observable,loss:new r.Observable,access:new r.Observable},this.syncState=new r.Map,this.syncWaits=new r.Observable,this.snapshotCycle=10,this.snapshotJobState=new r.Map;var o=new r.Set(function(e,t){return t>e?t:e}),i=new r.Set(function(e,t){return t>e?t:e});void this.cache.events.exec.monitor([],function(e){var t=(e[0],e[1]),r=t(void 0);if(r instanceof f==!1)return void i.add(r.key,r.date);var s=function(){return!o.has(r.key)||r.id>o.get(r.key)},a=function(){return!i.has(r.key)||r.date>i.get(r.key)&&r.date>n.cache.cast([r.key],void 0).filter(function(e){return e!==r}).reduce(function(e,t){return t.date>e?t.date:e},0)};s()&&a()?(void o.add(r.key,r.id),void i.add(r.key,r.date),void n.events.load.emit([r.key,r.attr,r.type],new l(r.type,r.id,r.key,r.attr))):(void o.add(r.key,r.id),void i.add(r.key,r.date))})}return e.configure=function(e){return{make:function(t){var r=t.objectStoreNames.contains(e)?t.transaction(e).objectStore(e):t.createObjectStore(e,{keyPath:y.id,autoIncrement:!0});return r.indexNames.contains(y.id)||void r.createIndex(y.id,y.id,{unique:!0}),r.indexNames.contains(y.key)||void r.createIndex(y.key,y.key),r.indexNames.contains(y.type)||void r.createIndex(y.type,y.type),r.indexNames.contains(y.attr)||void r.createIndex(y.attr,y.attr),r.indexNames.contains(y.value)||void r.createIndex(y.value,y.value),r.indexNames.contains(y.date)||void r.createIndex(y.date,y.date),r.indexNames.contains(y.surrogateKeyDateField)||void r.createIndex(y.surrogateKeyDateField,[y.key,y.date]),!0},verify:function(t){return t.objectStoreNames.contains(e)&&t.transaction(e).objectStore(e).indexNames.contains(y.id)&&t.transaction(e).objectStore(e).indexNames.contains(y.key)&&t.transaction(e).objectStore(e).indexNames.contains(y.type)&&t.transaction(e).objectStore(e).indexNames.contains(y.attr)&&t.transaction(e).objectStore(e).indexNames.contains(y.value)&&t.transaction(e).objectStore(e).indexNames.contains(y.date)&&t.transaction(e).objectStore(e).indexNames.contains(y.surrogateKeyDateField)},destroy:function(){return!0}}},e.prototype.sync=function(e,t){var n=this;return void 0===t&&(t=s.noop),void e.reduce(function(e,o){switch(n.syncState.get(o)){case!0:return e.then(function(e){return r.concat(e,[void 0])});case!1:if(t===s.noop)return e.then(function(e){return r.concat(e,[void 0])});var i=r.Msg();return void n.syncWaits.once([o],function(e){return void i.send([e])}),e.then(function(e){return i.then(function(t){return r.concat(e,t)})});default:if(void n.update(o),t===s.noop)return e.then(function(e){return r.concat(e,[void 0])});var a=r.Msg();return void n.syncWaits.once([o],function(e){return void a.send([e])}),e.then(function(e){return a.then(function(t){return r.concat(e,t)})})}},r.Msg().send([],!0)).then(t)},e.prototype.update=function(e){var t=this,o=this.meta(e),i=[];return void this.syncState.set(e,this.syncState.get(e)===!0),void this.cursor(e,y.key,n.IDBCursorDirection.prev,n.IDBTransaction.readonly,function(n,s){if(s)return void t.syncWaits.emit([e],s);if(!n||n.value.id<=o.id)return a(i).reduce(function(e){return e}).type===c[c["delete"]]?void t.clean(1/0,e):(void i.reduceRight(function(e,t){return e.some(function(e){var r=e.attr;return r===t.attr})?e:r.concat([t],e)},[]).reduce(function(e,t){switch(c[t.type]){case c.put:return r.concat([t],e);default:return[t]}},[]).reduce(function(e,n){void t.cache.terminate([n.key,n.attr,r.sqid(n.id)]),void t.cache.register([n.key,n.attr,r.sqid(n.id)],function(e){return n})},void 0),void t.cache.cast([e],void 0)),void t.syncState.set(e,!0),void t.syncWaits.emit([e],void 0),void(i.length>t.snapshotCycle&&void t.snapshot(e));var d=n.value;t.cache.refs([d.key,d.attr,r.sqid(d.id)]).length>0||(void i.unshift(new f(d.id,d.key,d.value,c[d.type],d.date)),d.type===c[c.put]&&void n["continue"]())})},e.prototype.meta=function(e){var t=this.cache.cast([e],void 0);return Object.freeze(i.assign({id:t.reduce(function(e,t){return t.id>e?t.id:e},0),date:0},a(t).reduce(function(e){return e}),{key:e}))},e.prototype.has=function(e){return a(this.cache.cast([e],void 0)).reduce(function(e){return e}).type!==c[c["delete"]]},e.prototype.get=function(e){return void this.sync([e]),void this.events.access.emit([e],new l(t.ESEventTypes.query,o.IdNumber(0),e,"")),a(this.cache.cast([e],void 0)).reduce(function(e){return e}).value},e.prototype.add=function(e){var t=this;if(void this.events.access.emit([e.key,e.attr,e.type],new l(e.type,o.IdNumber(0),e.key,e.attr)),e instanceof v==!1)throw new Error("LocalSocket: Cannot add a saved event: "+JSON.stringify(e));void this.sync([e.key]);var i=r.sqid();return void this.cache.register([e.key,e.attr,r.sqid(0),i],function(t){return e}),void this.cache.cast([e.key,e.attr,r.sqid(0),i],void 0),void this.access(function(s){if(0!==t.cache.refs([e.key,e.attr,r.sqid(0)]).length){var a=s.transaction(t.name,n.IDBTransaction.readwrite),d=a.objectStore(t.name).add(e);a.oncomplete=function(n){var s=new f(o.IdNumber(d.result),e.key,e.value,c[e.type],e.date);void t.cache.terminate([s.key,s.attr,r.sqid(0),i]),void t.cache.register([s.key,s.attr,r.sqid(s.id)],function(e){return s}),void t.events.save.emit([s.key,s.attr,s.type],new l(s.type,s.id,s.key,s.attr)),void t.cache.cast([s.key,s.attr,r.sqid(s.id)],void 0),t.cache.refs([e.key]).filter(function(e){var t=e[1];return t(void 0)instanceof f}).length>t.snapshotCycle?void t.snapshot(e.key):s.type===c[c["delete"]]&&void t.clean(1/0,s.key)},a.onerror=a.onabort=function(n){void setTimeout(function(){0!==t.cache.refs([e.key,e.attr,r.sqid(0),i]).length&&void t.events.loss.emit([e.key,e.attr,e.type],new l(e.type,e.id,e.key,e.attr))},1e3)}}})},e.prototype["delete"]=function(e){return void this.add(new v(e,new d,c["delete"]))},e.prototype.snapshot=function(e){var t=this;if(!this.snapshotJobState.get(e))return void this.snapshotJobState.set(e,!0),void this.access(function(r){var o=r.transaction(t.name,n.IDBTransaction.readwrite),i=o.objectStore(t.name),s=i.index(y.key).openCursor(e,n.IDBCursorDirection.prev),d=[];s.onsuccess=function(r){var n=s.result;if(n){var o=n.value;void d.unshift(new f(o.id,o.key,o.value,c[o.type],o.date))}if(!n||c[n.value.type]!==c.put){if(d.length<t.snapshotCycle)return;void t.clean(1/0,e);var u=a(d).reduce(function(e){return e});if(u instanceof f)return;switch(u.type){case c[c.snapshot]:return void i.add(new v(u.key,u.value,c[u.type],d.reduce(function(e,t){return t.date>e?t.date:e},0)));case c[c["delete"]]:return}throw new TypeError("LocalSocket: Invalid event type: "+u.type)}void n["continue"]()},o.oncomplete=function(r){void t.snapshotJobState.set(e,!1),void t.update(e)},o.onerror=o.onabort=function(r){void t.snapshotJobState.set(e,!1)}})},e.prototype.clean=function(e,t){var o=this;void 0===e&&(e=1/0);var i=[],s=new r.Map;return void this.cursor(t?n.IDBKeyRange.bound([t,0],[t,e]):n.IDBKeyRange.upperBound(e),t?y.surrogateKeyDateField:y.date,n.IDBCursorDirection.prev,n.IDBTransaction.readwrite,function(e,t){if(!e)return void i.reduce(function(e,t){return void o.cache.terminate([t.key,t.attr,r.sqid(t.id)])},void 0);var n=e.value;switch(n.type){case c[c.put]:void s.set(n.key,s.get(n.key)||!1);break;case c[c.snapshot]:if(!s.get(n.key))return void s.set(n.key,!0),void void e["continue"]();break;case c[c["delete"]]:void s.set(n.key,!0);break;default:void s.set(n.key,!0)}s.get(n.key)&&(void e["delete"](),void i.unshift(n)),void e["continue"]()})},e.prototype.cursor=function(e,t,r,n,o){var i=this;return void this.access(function(s){var a=s.transaction(i.name,n),c=t?a.objectStore(i.name).index(t).openCursor(e,r):a.objectStore(i.name).openCursor(e,r);c.onsuccess=function(e){return c.result&&o(c.result,c.error)},a.oncomplete=function(e){return void o(null,a.error)},a.onerror=a.onabort=function(e){return void o(null,a.error)}})},e}();t.AbstractEventStore=p,t.compose=a}),define("src/layer/domain/indexeddb/model/schema/socket/data",["require","exports","src/layer/domain/indexeddb/model/store/event"],function(e,t,r){"use strict";t.STORE_NAME="data",t.STORE_FIELDS={key:"key"};var n=function(){function e(){}return e}();t.DataValue=n;var o=function(e){function n(r){e.call(this,r,t.STORE_NAME),void Object.freeze(this)}return __extends(n,e),n.configure=function(){return r.AbstractEventStore.configure(t.STORE_NAME)},n}(r.AbstractEventStore);t.DataStore=o}),define("src/layer/domain/indexeddb/model/store/key-value",["require","exports","arch-stream","src/layer/infrastructure/indexeddb/api","src/lib/noop"],function(e,t,r,n,o){"use strict";!function(e){e[e.get=0]="get",e[e.put=1]="put",e[e["delete"]=2]="delete"}(t.EventTypes||(t.EventTypes={}));var i=t.EventTypes,s=function(){function e(e,t,n){if(this.access=e,this.name=t,this.index=n,this.cache=new r.Map,this.events={access:new r.Observable},"string"!=typeof n)throw new TypeError}return e.configure=function(){return{make:function(){return!0},verify:function(){return!0},destroy:function(){return!0}}},e.prototype.get=function(e,t){var r=this;return void 0===t&&(t=o.noop),void this.events.access.emit([e],[[e],i.get]),void this.access(function(o){var i,s=o.transaction(r.name,n.IDBTransaction.readonly),a=r.index?s.objectStore(r.name).index(r.index).get(e):s.objectStore(r.name).get(e);a.onsuccess=function(t){return i=void 0!==a.result&&null!==a.result?a.result:r.cache.get(e)},s.oncomplete=function(e){return t(i,s.error)},s.onerror=s.onabort=function(e){return t(void 0,s.error)}}),this.cache.get(e)},e.prototype.set=function(e,t,r){return void 0===r&&(r=o.noop),this.put(t,e,r)},e.prototype.put=function(e,t,r){var s=this;return void 0===r&&(r=o.noop),void this.cache.set(t,e),void this.events.access.emit([t],[[t],i.put]),void this.access(function(e){if(s.cache.has(t)){var o=e.transaction(s.name,n.IDBTransaction.readwrite);s.index?o.objectStore(s.name).put(s.cache.get(t)):o.objectStore(s.name).put(s.cache.get(t),t);o.oncomplete=o.onerror=o.onabort=function(e){return void r(t,o.error)}}}),this.cache.get(t)},e.prototype["delete"]=function(e,t){var r=this;void 0===t&&(t=o.noop),void this.cache["delete"](e),void this.events.access.emit([e],[[e],i["delete"]]),void this.access(function(o){var i=o.transaction(r.name,n.IDBTransaction.readwrite);i.objectStore(r.name)["delete"](e);i.oncomplete=i.onerror=i.onabort=function(e){return void t(i.error)}})},e.prototype.cursor=function(e,t,r,n,o){var i=this;void this.access(function(s){var a=s.transaction(i.name,n),c=t?a.objectStore(i.name).index(t).openCursor(e,r):a.objectStore(i.name).openCursor(e,r);c.onsuccess=function(e){return c.result&&o(c.result,c.error)},a.oncomplete=function(e){return void o(null,a.error)},a.onerror=a.onabort=function(e){return void o(null,a.error)}})},e}();t.AbstractKeyValueStore=s}),define("src/layer/domain/indexeddb/model/schema/socket/access",["require","exports","src/layer/domain/indexeddb/model/store/key-value","src/layer/domain/indexeddb/model/store/event"],function(e,t,r,n){"use strict";t.STORE_NAME="access",t.STORE_FIELDS={key:"key",date:"date"};var o=function(){function e(e,t){this.key=e,this.date=t}return e}(),i=function(e){function r(r,i){var s=this;e.call(this,r,t.STORE_NAME,t.STORE_FIELDS.key),void Object.freeze(this),void i.monitor([],function(e){var t=e.key,r=e.type;return r===n.ESEventTypes["delete"]?void s["delete"](t):void s.set(t,new o(t,Date.now()))})}return __extends(r,e),r.configure=function(){return{make:function(e){var r=e.objectStoreNames.contains(t.STORE_NAME)?e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME):e.createObjectStore(t.STORE_NAME,{keyPath:t.STORE_FIELDS.key,autoIncrement:!1});return r.indexNames.contains(t.STORE_FIELDS.key)||void r.createIndex(t.STORE_FIELDS.key,t.STORE_FIELDS.key,{unique:!0}),r.indexNames.contains(t.STORE_FIELDS.date)||void r.createIndex(t.STORE_FIELDS.date,t.STORE_FIELDS.date),!0},verify:function(e){return e.objectStoreNames.contains(t.STORE_NAME)&&e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME).indexNames.contains(t.STORE_FIELDS.key)&&e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME).indexNames.contains(t.STORE_FIELDS.date)},destroy:function(){return!0}}},r}(r.AbstractKeyValueStore);t.AccessStore=i}),define("src/layer/domain/indexeddb/model/schema/socket/expiry",["require","exports","src/layer/infrastructure/indexeddb/api","src/layer/domain/indexeddb/model/store/key-value","src/layer/domain/indexeddb/model/store/event"],function(e,t,r,n,o){"use strict";t.STORE_NAME="expiry",t.STORE_FIELDS={key:"key",expiry:"expiry"};var i=function(){function e(e,t){this.key=e,this.expiry=t}return e}(),s=function(e){function n(n,s,a){var c=this;e.call(this,n,t.STORE_NAME,t.STORE_FIELDS.key),void Object.freeze(this);var d=0,u=1/0,v=function(e){e>u||(void clearTimeout(d),u=e,d=setTimeout(function(){u=1/0,void c.cursor(null,t.STORE_FIELDS.expiry,r.IDBCursorDirection.next,r.IDBTransaction.readonly,function(e){if(e){var t=e.value;t.expiry>Date.now()?void v(t.expiry):(void s["delete"](t.key),void e["continue"]())}})},e-Date.now()))};void v(Date.now()),void s.events.access.monitor([],function(e){var t=e.key,r=e.type;if(r===o.ESEventTypes["delete"])void c["delete"](t);else{if(!a.has(t))return;var n=Date.now()+a.get(t);void c.set(t,new i(t,n)),void v(n)}})}return __extends(n,e),n.configure=function(){return{make:function(e){var r=e.objectStoreNames.contains(t.STORE_NAME)?e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME):e.createObjectStore(t.STORE_NAME,{keyPath:t.STORE_FIELDS.key,autoIncrement:!1});return r.indexNames.contains(t.STORE_FIELDS.key)||void r.createIndex(t.STORE_FIELDS.key,t.STORE_FIELDS.key,{unique:!0}),r.indexNames.contains(t.STORE_FIELDS.expiry)||void r.createIndex(t.STORE_FIELDS.expiry,t.STORE_FIELDS.expiry),!0},verify:function(e){return e.objectStoreNames.contains(t.STORE_NAME)&&e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME).indexNames.contains(t.STORE_FIELDS.key)&&e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME).indexNames.contains(t.STORE_FIELDS.expiry)},destroy:function(){return!0}}},n}(n.AbstractKeyValueStore);t.ExpiryStore=s}),define("src/layer/domain/indexeddb/model/schema/socket",["require","exports","arch-stream","src/layer/infrastructure/indexeddb/api","src/layer/domain/indexeddb/model/types","src/layer/domain/indexeddb/model/store/event","src/layer/domain/indexeddb/model/schema/socket/data","src/layer/domain/indexeddb/model/schema/socket/access","src/layer/domain/indexeddb/model/schema/socket/expiry","src/lib/noop"],function(e,t,r,n,o,i,s,a,c,d){"use strict";t.SocketRecord=i.UnsavedEventRecord,t.ESEventTypes=i.ESEventTypes,t.SocketValue=s.DataValue;var u=function(){function e(e,t,o){void 0===o&&(o=1/0),this.name=e,this.expiry=o,this.expiries=new r.Map,void n.open(e,{make:function(e){return s.DataStore.configure().make(e)&&a.AccessStore.configure().make(e)&&c.ExpiryStore.configure().make(e)},verify:function(e){return s.DataStore.configure().verify(e)&&a.AccessStore.configure().verify(e)&&c.ExpiryStore.configure().verify(e)},destroy:function(e,r){return s.DataStore.configure().destroy(e,r)&&a.AccessStore.configure().destroy(e,r)&&c.ExpiryStore.configure().destroy(e,r)&&t(e,r)}}),this.schema=new v(n.listen(e),this.expiries),this.events=this.schema.data.events}return e.prototype.sync=function(e,t){return void 0===t&&(t=d.noop),this.schema.data.sync(e,t)},e.prototype.meta=function(e){return this.schema.data.meta(o.KeyString(e))},e.prototype.has=function(e){return this.schema.data.has(o.KeyString(e))},e.prototype.get=function(e){return this.schema.data.get(o.KeyString(e))},e.prototype.add=function(e){return this.schema.data.add(e)},e.prototype["delete"]=function(e){return this.schema.data["delete"](o.KeyString(e))},e.prototype.expire=function(e,t){return void 0===t&&(t=this.expiry),t!==1/0?void this.expiries.set(e,t):void 0},e.prototype.recent=function(e,t){var r=[];return void this.schema.access.cursor(null,a.STORE_FIELDS.date,n.IDBCursorDirection.prevunique,n.IDBTransaction.readonly,function(n,o){return n?void(--e<0||(void r.push(n.primaryKey),void n["continue"]())):void t(r,o)})},e.prototype.destroy=function(){return n.destroy(this.name)},e}();t.SocketStore=u;var v=function(){function e(e,t){this.data=new s.DataStore(e),this.access=new a.AccessStore(e,this.data.events.access),this.expire=new c.ExpiryStore(e,this.data,t),void Object.freeze(this)}return e}()}),define("src/layer/domain/webstorage/service/event",["require","exports","arch-stream","src/layer/infrastructure/webstorage/api"],function(e,t,r,n){"use strict";function o(e){var t=new r.Observable;return void e.on(["storage"],function(e){return void t.emit([e.key],e)}),t}t.events={localStorage:o(n.events.localStorage),sessionStorage:o(n.events.sessionStorage)}}),define("src/layer/domain/webstorage/service/storage",["require","exports","arch-stream"],function(e,t,r){"use strict";var n=function(){function e(){this.store=new r.Map}return Object.defineProperty(e.prototype,"length",{get:function(){return this.store.size},enumerable:!0,configurable:!0}),e.prototype.getItem=function(e){return this.store.has(e)?this.store.get(e):null},e.prototype.setItem=function(e,t){void this.store.set(e,t)},e.prototype.removeItem=function(e){void this.store["delete"](e)},e.prototype.clear=function(){
void this.store.clear()},e}();t.fakeStorage=new n}),define("src/layer/domain/webstorage/repository/port",["require","exports","arch-stream","src/layer/domain/dao/api","src/layer/domain/webstorage/service/event","src/layer/infrastructure/webstorage/api","src/layer/domain/webstorage/service/storage"],function(e,t,r,n,o,i,s){"use strict";function a(e,t,r,n){return void 0===t&&(t=i.sessionStorage||s.fakeStorage),void 0===n&&(n={update:function(e){},"delete":function(e){}}),new f(e,t,r,n)}var c,d=new r.Set,u=(new r.Set,new r.Set);new r.Set;!function(e){e.send="send",e.recv="recv"}(c=t.PortEventTypes||(t.PortEventTypes={}));var v=function(){function e(e,t,r,n,o){this.type=e,this.key=t,this.attr=r,this.newValue=n,this.oldValue=o}return e}();t.PortEvent=v,t.repository=a;var f=function(){function e(e,t,n,s){void 0===s&&(s={update:function(e){},"delete":function(e){}}),this.name=e,this.storage=t,this.factory=n,this.log=s,this.cache=this.storage===i.localStorage?d:u,this.eventSource=this.storage===i.localStorage?o.events.localStorage:o.events.sessionStorage,this.uuid=r.uuid(),this.events={send:new r.Observable,recv:new r.Observable},void Object.freeze(this)}return e.prototype.link=function(){function e(e){try{return JSON.parse(e)||{}}catch(t){return{}}}var t=this;if(this.cache.has(this.name))return this.cache.get(this.name);var o=r.assign((a={},a[n.SCHEMA.KEY.NAME]=this.name,a[n.SCHEMA.EVENT.NAME]=new r.Observable,a),e(this.storage.getItem(this.name)||"{}")),i=n.build(o,this.factory,function(e,r,i){void t.log.update(t.name),void t.storage.setItem(t.name,JSON.stringify(Object.keys(o).filter(n.isValidPropertyName).filter(n.isValidPropertyValue(o)).reduce(function(e,t){return Object.defineProperty(e,t,{value:o[t],enumerable:!0,writable:!0,configurable:!0})},{})));var s=new v(c.send,t.name,e,r,i);void o.__event.emit([s.type,s.attr],s),void t.events.send.emit([s.attr],s)}),s=function(r){var i=r.newValue,s=e(i);void Object.keys(s).filter(n.isValidPropertyName).filter(n.isValidPropertyValue(s)).reduce(function(e,r){var n=o[r],i=s[r];if(i!==n){o[r]=i;var a=new v(c.recv,t.name,r,i,n);void o.__event.emit([a.type,a.attr],a),void t.events.recv.emit([a.attr],a)}},void 0)};return void this.eventSource.on([this.name,this.uuid],s),void this.cache.add(this.name,i),void this.log.update(this.name),i;var a},e.prototype.close=function(){void this.eventSource.off([this.name,this.uuid]),void this.cache["delete"](this.name)},e.prototype.destroy=function(){void this.close(),void this.storage.removeItem(this.name),void this.log["delete"](this.name)},e}()}),define("src/layer/domain/indexeddb/repository/socket",["require","exports","arch-stream","src/layer/domain/dao/api","src/layer/domain/indexeddb/model/schema/socket","src/layer/infrastructure/webstorage/api","src/layer/domain/webstorage/repository/port","src/layer/domain/indexeddb/model/types","src/layer/domain/lib/assign"],function(e,t,r,n,o,i,s,a,c){"use strict";function d(e,t,r,n){return void 0===n&&(n=1/0),new f(e,t,n,r)}t.socket=d;var u=function(){function e(e,t,r){this.key=e,this.attr=t,this.date=r}return e}(),v=function(){function e(){this.msgs=[],this.msgHeadSet_=new r.Set(function(e,t){return t>e?t:e})}return e.prototype.recv=function(){var e=this;return this.msgs.map(function(e){return new u(e.key,e.attr,e.date)}).filter(function(t){return!e.msgHeadSet_.has(t.key)||t.date>e.msgHeadSet_.get(t.key)}).filter(function(t){return!void e.msgHeadSet_.add(t.key,t.date)})},e.prototype.send=function(e){this.msgs=r.concat([e],this.msgs.slice(0,9))},e}(),f=function(e){function t(t,a,c,d){var f=this;e.call(this,t,d,c),this.factory=a,this.proxy=s.repository(this.name,i.localStorage,function(){return new v}),this.port=this.proxy.link(),this.links=new r.Set,this.sources=new r.Set,void this.port.__event.on([s.PortEventTypes.recv,"msgs"],function(e){e.newValue;void f.port.recv().reduce(function(e,t){return void f.schema.data.update(t.key)},void 0)}),void this.events.save.monitor([],function(e){var t=(e.id,e.key),r=e.attr;void f.port.send(new u(t,r,Date.now()))}),void this.events.load.monitor([],function(e){var t=(e.id,e.key),r=e.attr,i=e.type,a=f.sources.get(t);if(a)switch(i){case o.ESEventTypes.put:var c=a[r],d=f.get(t)[r];return a[r]=d,void void a.__event.emit([s.PortEventTypes.recv,r],new s.PortEvent(s.PortEventTypes.recv,t,r,d,c));case o.ESEventTypes["delete"]:var u=f.get(t);return void void Object.keys(u).filter(n.isValidPropertyName).filter(n.isValidPropertyValue(u)).sort().reduce(function(e,r){var n=a[r],o=void 0;a[r]=o,void a.__event.emit([s.PortEventTypes.recv,r],new s.PortEvent(s.PortEventTypes.recv,t,r,o,n))},void 0);case o.ESEventTypes.snapshot:var v=f.get(t);return void void Object.keys(v).filter(n.isValidPropertyName).filter(n.isValidPropertyValue(v)).sort().reduce(function(e,r){var n=a[r],o=v[r];a[r]=o,void a.__event.emit([s.PortEventTypes.recv,r],new s.PortEvent(s.PortEventTypes.recv,t,r,o,n))},void 0)}}),void Object.freeze(this)}return __extends(t,e),t.prototype.link=function(e,t){var i=this;return void this.expire(e,t),this.links.has(e)?this.links.get(e):this.links.add(e,n.build(Object.defineProperties(this.sources.add(e,c.assign({},this.get(e))),{__meta:{get:function(){return i.meta(e)}},__id:{get:function(){return this.__meta.id}},__key:{get:function(){return this.__meta.key}},__date:{get:function(){return this.__meta.date}},__event:{value:new r.Observable}}),this.factory,function(t,r,n){void i.add(new o.SocketRecord(a.KeyString(e),(c={},c[t]=r,c))),void i.sources.get(e).__event.emit([s.PortEventTypes.send,t],new s.PortEvent(s.PortEventTypes.send,e,t,r,n));var c}))},t.prototype.close=function(){void this.proxy.close()},t.prototype.destroy=function(){void this.close(),void this.proxy.destroy(),void e.prototype.destroy.call(this)},t}(o.SocketStore)}),define("src/layer/domain/indexeddb/service/event",["require","exports","src/layer/infrastructure/indexeddb/api"],function(e,t,r){"use strict";t.event=r.event}),define("src/layer/domain/indexeddb/api",["require","exports","src/layer/domain/indexeddb/repository/socket","src/layer/domain/indexeddb/service/event"],function(e,t,r,n){"use strict";t.socket=r.socket,t.event=n.event}),define("src/layer/domain/webstorage/service/log",["require","exports","src/layer/infrastructure/webstorage/api","src/layer/domain/webstorage/repository/port"],function(e,t,r,n){"use strict";var o=1,i=function(){function e(){this.version=o,this.logs=Object.create(null)}return e.prototype.verify=function(){return this.version===o?!0:(this.logs=Object.create(null),(this.version>o||!this.version)&&(this.logs=this.logs),!1)},e.prototype.has=function(e){return void this.verify(),e in this.logs},e.prototype.get=function(e){return void this.verify(),this.logs[e]||0},e.prototype.update=function(e){void this.verify(),this.logs[e]=Date.now()},e.prototype["delete"]=function(e){void this.verify(),delete this.logs[e]},e.prototype.clear=function(){void this.verify(),this.logs=Object.create(null)},e.prototype.commit=function(){this.verify()&&(this.logs=this.logs)},e.prototype.entries=function(){var e=this;return this.verify()?Object.keys(this.logs).map(function(t){return[t,e.logs[t]]}):[]},e}();t.WebStorageLog=i,t.namespace="localsocket::log",t.log=r.localStorage?n.repository(t.namespace,r.localStorage,function(){return new i}).link():new i,void setInterval(function(){return void t.log.commit()},1e3),void window.addEventListener("unload",function(){return void t.log.commit()})}),define("src/layer/domain/webstorage/service/expiry",["require","exports","src/layer/infrastructure/webstorage/api","src/layer/domain/webstorage/repository/port","src/layer/domain/webstorage/service/log"],function(e,t,r,n,o){"use strict";var i=1,s=function(){function e(){this.version=i,this.expiries=Object.create(null)}return e.prototype.verify=function(){return this.version===i?!0:(this.expiries=Object.create(null),(this.version>i||!this.version)&&(this.expiries=this.expiries),!1)},e.prototype.has=function(e){return void this.verify(),e in this.expiries},e.prototype.get=function(e){return void this.verify(),this.expiries[e]||0},e.prototype.add=function(e,t){void this.verify(),this.expiries[e]=t,void this.clean_(e)},e.prototype["delete"]=function(e){void this.verify(),delete this.expiries[e]},e.prototype.clear=function(){void this.verify(),this.expiries=Object.create(null)},e.prototype.commit=function(){this.verify()&&(this.expiries=this.expiries)},e.prototype.entries=function(){var e=this;return this.verify()?Object.keys(this.expiries).map(function(t){return[t,e.expiries[t]]}):[]},e.prototype.clean=function(e){var r=this;void 0===e&&(e=Date.now()),void t.expiry.entries().forEach(function(t){var n=t[0];return void r.clean_(n,e)})},e.prototype.clean_=function(e,i){void 0===i&&(i=Date.now()),o.log.has(e)&&t.expiry.has(e)&&(o.log.get(e)+t.expiry.get(e)>i||(void n.repository(e,r.localStorage,Object).destroy(),void t.expiry["delete"](e),void o.log["delete"](e)))},e}();t.WebStorageExpiry=s,t.namespace="localsocket::expiry",t.expiry=r.localStorage?n.repository(t.namespace,r.localStorage,function(){return new s}).link():new s,void setInterval(function(){return void t.expiry.commit()},1e3),void window.addEventListener("unload",function(){return void t.expiry.commit()}),void t.expiry.clean()}),define("src/layer/domain/webstorage/api",["require","exports","src/layer/domain/webstorage/repository/port","src/layer/domain/webstorage/service/log","src/layer/domain/webstorage/service/expiry","src/layer/infrastructure/webstorage/api","src/layer/infrastructure/webstorage/api","src/layer/domain/webstorage/service/event"],function(e,t,r,n,o,i,s,a){"use strict";function c(e,t,s,a){return void o.expiry.add(e,a),r.repository(e,t,s,t===i.localStorage?n.log:void 0)}t.localStorage=s.localStorage,t.sessionStorage=s.sessionStorage,t.supportWebStorage=s.supportWebStorage,t.events=a.events,t.webstorage=c}),define("src/layer/app/api",["require","exports","src/layer/domain/indexeddb/api","src/layer/domain/webstorage/api","src/layer/domain/indexeddb/api","src/layer/domain/webstorage/api","src/layer/domain/webstorage/api"],function(e,t,r,n,o,i,s){"use strict";function a(e,t){function n(e){var t=function(){function e(e,t,r){void 0===t&&(t=1/0),void 0===r&&(r=function(){return!0}),this.schema=e,this.expiry=t,this.destroy=r,void Object.freeze(this)}return e}();return new t(e.schema,e.expiry,e.destroy)}return t=n(t),r.socket(e,t.schema,t.destroy,t.expiry)}function c(e,t){function r(e){var t=function(){function e(e,t,r){void 0===t&&(t=2592e6),void 0===r&&(r=function(){return!0}),this.schema=e,this.expire=t,this.destroy=r,void Object.freeze(this)}return e}();return new t(e.schema,e.expiry,e.destroy)}return t=r(t),n.webstorage(e,n.localStorage,t.schema,t.expiry)}t.status=s.supportWebStorage,t.socket=a,t.port=c;var d;!function(e){e.indexedDB=o.event,e.localStorage=i.events.localStorage,e.sessionStorage=i.events.sessionStorage}(d=t.events||(t.events={}))}),define("src/layer/interface/api",["require","exports","src/layer/app/api"],function(e,t,r){"use strict";t.socket=r.socket,t.port=r.port,t.events=r.events,t.status=r.status}),define("src/export",["require","exports","src/layer/interface/api"],function(e,t,r){"use strict";t["default"]=r.socket,t.socket=r.socket,t.port=r.port,t.status=r.status}),define("localsocket",["require","exports","src/export","src/export"],function(e,t,r,n){"use strict";function o(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}o(r),t["default"]=n["default"]}),define("src/layer/domain/indexeddb/model/api",["require","exports","src/layer/infrastructure/indexeddb/api"],function(e,t,r){"use strict";t.IDBKeyRange=r.IDBKeyRange});