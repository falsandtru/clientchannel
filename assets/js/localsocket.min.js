/*! localsocket v0.2.1 https://github.com/falsandtru/localsocket | (c) 2016, falsandtru | undefined License (undefined) */
define="function"==typeof define&&define.amd?define:function(){"use strict";var e="localsocket",t={};return function n(r,o,i){return i?void i.apply(this,o.map(function(e){switch(e){case"require":return"function"==typeof require?require:void 0;case"exports":return-1===r.indexOf("/")?t[r]="undefined"==typeof exports?self[r]=self[r]||{}:exports:t[r]=t.hasOwnProperty(r)?t[r]:{};default:return".d"===e.slice(-2)&&{}||t.hasOwnProperty(e)&&t[e]||"function"==typeof require&&require(e)||self[e]}})):void n(e,r,o)}}();var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)};define("src/layer/data/constraint/values",["require","exports"],function(e,t){"use strict";function n(e){return e.length>0&&"_"!==e[0]&&"_"!==e[e.length-1]&&!i.test(e)&&o.test(e)}function r(e){return function(t){switch(typeof e[t]){case"undefined":case"boolean":case"number":case"string":case"object":return!0;default:return!1}}}var o=/^[A-z][0-9A-z_]*$/,i=/^[0-9A-Z_]+$/;t.isValidName=n,t.isValidValue=r}),define("src/lib/noop",["require","exports"],function(e,t){"use strict";function n(){}t.noop=n}),define("src/layer/domain/dao/module/builder",["require","exports","spica","src/layer/data/constraint/values","src/lib/noop"],function(e,t,n,r,o){"use strict";function i(e,i,a){void 0===a&&(a=o.noop);var s=i();if(void Object.keys(t.SCHEMA).map(function(e){return t.SCHEMA[e].NAME}).reduce(function(e,t){delete s[t]},void 0),"string"!=typeof e[t.SCHEMA.KEY.NAME])throw new TypeError("LocalSocket: Invalid key: "+e[t.SCHEMA.KEY.NAME]);var c=n.assign(Object.keys(s).filter(r.isValidName).filter(r.isValidValue(s)).reduce(function(t,n){var o=Object.getOwnPropertyDescriptor(s,n);if(o&&(o.get||o.set))return t;var i=s[n];return void 0===e[n]&&(e[n]=i),t[n]={enumerable:!0,get:function(){return void 0===e[n]?i:e[n]},set:function(t){var o=e[n];r.isValidValue(e)(n)&&(t===o&&t instanceof Object==!1||(e[n]=void 0===t?i:t,void a(n,t,o)))}},t},{}),(d={},d[t.SCHEMA.META.NAME]={configurable:!1,enumerable:!1,get:function(){return e[t.SCHEMA.META.NAME]}},d[t.SCHEMA.ID.NAME]={configurable:!1,enumerable:!1,get:function(){return e[t.SCHEMA.ID.NAME]}},d[t.SCHEMA.KEY.NAME]={configurable:!1,enumerable:!1,get:function(){return e[t.SCHEMA.KEY.NAME]}},d[t.SCHEMA.DATE.NAME]={configurable:!1,enumerable:!1,get:function(){return e[t.SCHEMA.DATE.NAME]}},d[t.SCHEMA.EVENT.NAME]={configurable:!1,enumerable:!1,get:function(){return e[t.SCHEMA.EVENT.NAME]}},d));return void Object.defineProperties(s,c),void Object.seal(s),s;var d}t.isValidPropertyName=r.isValidName,t.isValidPropertyValue=r.isValidValue,t.SCHEMA={META:{NAME:"__meta"},ID:{NAME:"__id"},KEY:{NAME:"__key"},DATE:{NAME:"__date"},EVENT:{NAME:"__event"}},t.build=i}),define("src/layer/domain/dao/api",["require","exports","src/layer/domain/dao/module/builder"],function(e,t,n){"use strict";t.SCHEMA=n.SCHEMA,t.build=n.build,t.isValidPropertyName=n.isValidPropertyName,t.isValidPropertyValue=n.isValidPropertyValue}),define("src/layer/infrastructure/indexeddb/module/global",["require","exports"],function(e,t){"use strict";t.indexedDB=self.indexedDB||self.webkitIndexedDB||self.mozIndexedDB||self.msIndexedDB;var n=self.IDBKeyRange||self.webkitIDBKeyRange||self.mozIDBKeyRange||self.msIDBKeyRange;t.IDBKeyRange=n;var r;!function(e){e.readonly="readonly",e.readwrite="readwrite"}(r=t.IDBTransaction||(t.IDBTransaction={}));var o;!function(e){e.next="next",e.nextunique="nextunique",e.prev="prev",e.prevunique="prevunique"}(o=t.IDBCursorDirection||(t.IDBCursorDirection={}))}),define("src/layer/infrastructure/indexeddb/model/event",["require","exports"],function(e,t){"use strict";var n;!function(e){e.connect="connect",e.disconnect="disconnect",e.block="block",e.error="error",e.abort="abort",e.crash="crash",e.destroy="destroy"}(n=t.IDBEventType||(t.IDBEventType={}));var r=function(){function e(e,t){this.type=e,this.name=t,this.namespace=[this.name],void Object.freeze(this)}return e}();t.IDBEvent=r}),define("src/layer/infrastructure/webstorage/module/global",["require","exports","spica"],function(e,t,n){"use strict";t.supportWebStorage=function(){try{var e="localsocket#"+n.uuid();if(void self.sessionStorage.setItem(e,e),e!==self.sessionStorage.getItem(e))throw 1;return void self.sessionStorage.removeItem(e),!0}catch(t){return!1}}(),t.localStorage=t.supportWebStorage?self.localStorage:void 0,t.sessionStorage=t.supportWebStorage?self.sessionStorage:void 0}),define("src/layer/infrastructure/webstorage/model/event",["require","exports","spica","src/layer/infrastructure/webstorage/module/global"],function(e,t,n,r){"use strict";var o={localStorage:new n.Observable,sessionStorage:new n.Observable};t.events=o,void window.addEventListener("storage",function(e){switch(e.storageArea){case r.localStorage:return void o.localStorage.emit(["storage"],e);case r.sessionStorage:return void o.sessionStorage.emit(["storage"],e)}})}),define("src/layer/infrastructure/webstorage/api",["require","exports","src/layer/infrastructure/webstorage/module/global","src/layer/infrastructure/webstorage/model/event"],function(e,t,n,r){"use strict";t.localStorage=n.localStorage,t.sessionStorage=n.sessionStorage,t.supportWebStorage=n.supportWebStorage,t.events=r.events}),define("src/layer/infrastructure/indexeddb/model/access",["require","exports","spica","src/layer/infrastructure/indexeddb/module/global","src/layer/infrastructure/indexeddb/model/event"],function(e,t,n,r,o){"use strict";function i(e,n){void y.set(e,0),void t.ConfigMap.set(e,n),p.has(e)||void d(new f.Initial(e))}function a(e){return function(t){var n=l.get(e)||l.set(e,[]).get(e);void n.push(t);var r=p.get(e);r instanceof f.Success&&void r.drain()}}function s(e){return void y.set(e,1),void t.ConfigMap.set(e,{make:function(){return!1},verify:function(){return!1},destroy:function(){return!1}}),p.get(e)instanceof f.Success?p.get(e).end():void(p.has(e)||void d(new f.Initial(e)))}function c(e){return void y.set(e,2),void t.ConfigMap.set(e,{make:function(){return!1},verify:function(){return!1},destroy:function(){return!0}}),p.get(e)instanceof f.Success?p.get(e).destroy():void(p.has(e)||void d(new f.Initial(e)))}function d(e,n){function i(e){var t=e.database;void u.emit([t,o.IDBEventType.block],new o.IDBEvent(o.IDBEventType.block,t))}function a(e){var n=e.database,r=e.session,o=r.transaction.db,i=t.ConfigMap.get(n),a=i.make,d=i.destroy;try{a(o)?(r.onsuccess=function(e){return void s(new f.Success(n,o))},r.onerror=function(e){return void c(new f.Error(n,r.error,e))}):r.onsuccess=r.onerror=function(e){void o.close(),d(r.error,e)?void E(new f.Destroy(n)):void m(new f.End(n))}}catch(u){void h(new f.Crash(n,u))}}function s(e){var n=e.database,r=e.connection,i=function(){r.onversionchange=function(){return void r.close()},r.onerror=void 0,r.onabort=void 0,r.onclose=void 0};switch(r.onversionchange=function(t){var a=t.newVersion;void i(),void r.close(),a||(void l["delete"](n),void u.emit([n,o.IDBEventType.destroy],new o.IDBEvent(o.IDBEventType.destroy,n))),p.get(n)===e&&void m(new f.End(n))},r.onerror=function(e){void i(),void c(new f.Error(n,e.target.error,e))},r.onabort=function(e){void i(),void v(new f.Abort(n,e.target.error,e))},r.onclose=function(t){void i(),void u.emit([n,o.IDBEventType.destroy],new o.IDBEvent(o.IDBEventType.destroy,n)),p.get(n)===e&&void m(new f.End(n))},e.destroy=function(){void i(),void r.close(),void E(new f.Destroy(n))},e.end=function(){void i(),void r.close(),void m(new f.End(n))},e.drain=function(){var e=l.get(n)||[];try{for(;e.length>0&&0===y.get(n);)void e[0](r),void e.shift()}catch(t){t instanceof DOMError||t instanceof DOMException?void console.warn(t):void console.error(t),void i(),void h(new f.Crash(n,t))}},y.get(n)){case 0:var a=t.ConfigMap.get(n).verify;try{if(!a(r))return void m(new f.End(n),r.version+1)}catch(s){return void h(new f.Crash(n,s))}return void u.emit([n,o.IDBEventType.connect],new o.IDBEvent(o.IDBEventType.connect,n)),void e.drain();case 1:return void e.end();case 2:return void e.destroy()}throw new TypeError("LocalSocket: Invalid command "+y.get(n)+".")}function c(e){var n=e.database,r=e.error,i=e.event;void i.preventDefault(),void u.emit([n,o.IDBEventType.error],new o.IDBEvent(o.IDBEventType.error,n));var a=t.ConfigMap.get(n).destroy;return a(r,i)?void E(new f.Destroy(n)):void m(new f.End(n))}function v(e){var n=e.database,r=e.error,i=e.event;void i.preventDefault(),void u.emit([n,o.IDBEventType.abort],new o.IDBEvent(o.IDBEventType.abort,n));var a=t.ConfigMap.get(n).destroy;return a(r,i)?void E(new f.Destroy(n)):void m(new f.End(n))}function h(e){var n=e.database,r=e.error;void u.emit([n,o.IDBEventType.crash],new o.IDBEvent(o.IDBEventType.crash,n));var i=t.ConfigMap.get(n).destroy;return i(r,null)?void E(new f.Destroy(n)):void m(new f.End(n))}function E(e){var t=e.database,n=r.indexedDB.deleteDatabase(t);n.onsuccess=function(e){void l["delete"](t),void u.emit([t,o.IDBEventType.destroy],new o.IDBEvent(o.IDBEventType.destroy,t)),void m(new f.End(t))},n.onerror=function(e){void c(new f.Error(t,n.error,e))}}function m(e,n){var r=e.database;switch(void 0===n&&(n=0),void p["delete"](r),y.get(r)){case 0:return void d(new f.Initial(r),n);case 1:return void y["delete"](r),void t.ConfigMap["delete"](r),void u.emit([r,o.IDBEventType.disconnect],new o.IDBEvent(o.IDBEventType.disconnect,r));case 2:return void y["delete"](r),void t.ConfigMap["delete"](r),void u.emit([r,o.IDBEventType.disconnect],new o.IDBEvent(o.IDBEventType.disconnect,r))}throw new TypeError("LocalSocket: Invalid command "+y.get(r)+".")}var b=e.database;void 0===n&&(n=0);t.ConfigMap.get(b);try{var g=n?r.indexedDB.open(b,n):r.indexedDB.open(b),S=function(){g.onupgradeneeded=void 0,g.onsuccess=void 0,g.onerror=void 0};g.onblocked=function(e){return void i(new f.Block(b))},g.onupgradeneeded=function(e){void S(),void a(new f.Upgrade(b,g))},g.onsuccess=function(e){void S(),void s(new f.Success(b,g.result))},g.onerror=function(e){void S(),void c(new f.Error(b,g.error,e))}}catch(w){void h(new f.Crash(b,w))}}var u=new n.Observable;t.event=u,t.ConfigMap=new Map;var v,y=new Map;!function(e){e[e.open=0]="open",e[e.close=1]="close",e[e.destroy=2]="destroy"}(v||(v={}));var f,p=new Map;!function(e){var t=function(){function e(e){this.database=e,void p.set(e,this)}return e}();e.Initial=t;var n=function(){function e(e){this.database=e,void p.set(e,this)}return e}();e.Block=n;var r=function(){function e(e,t){this.database=e,this.session=t,void p.set(e,this)}return e}();e.Upgrade=r;var o=function(){function e(e,t){this.database=e,this.connection=t,void p.set(e,this)}return e}();e.Success=o;var i=function(){function e(e,t,n){this.database=e,this.error=t,this.event=n,void p.set(e,this)}return e}();e.Error=i;var a=function(){function e(e,t,n){this.database=e,this.error=t,this.event=n,void p.set(e,this)}return e}();e.Abort=a;var s=function(){function e(e,t){this.database=e,this.error=t,void p.set(e,this)}return e}();e.Crash=s;var c=function(){function e(e){this.database=e,void p.set(e,this)}return e}();e.Destroy=c;var d=function(){function e(e){this.database=e,void p.set(e,this)}return e}();e.End=d}(f||(f={}));var l=new Map;t.open=i,t.listen=a,t.close=s,t.destroy=c}),define("src/layer/infrastructure/indexeddb/api",["require","exports","src/layer/infrastructure/indexeddb/module/global","src/layer/infrastructure/indexeddb/model/access","src/layer/infrastructure/indexeddb/model/event"],function(e,t,n,r,o){"use strict";t.indexedDB=n.indexedDB,t.IDBKeyRange=n.IDBKeyRange,t.IDBTransaction=n.IDBTransaction,t.IDBCursorDirection=n.IDBCursorDirection,t.open=r.open,t.listen=r.listen,t.close=r.close,t.destroy=r.destroy,t.event=r.event,t.IDBEvent=o.IDBEvent,t.IDBEventType=o.IDBEventType}),define("src/layer/data/constraint/types",["require","exports"],function(e,t){"use strict";function n(e){return+e}function r(e){return void 0!==e&&null!==e?e+"":""}t.IdNumber=n,t.KeyString=r}),define("src/layer/data/schema/event",["require","exports","spica"],function(e,t,n){"use strict";t.EventType={put:"put","delete":"delete",snapshot:"snapshot"};var r=function(){function e(){}return e}();t.EventValue=r;var o=function(){function e(e,o,i,a,s){if("number"==typeof this.id&&this.id>0==!1||void 0!==this.id)throw new TypeError("LocalSocket: EventRecord: Invalid event id: "+this.id);if(this.type=s,"string"!=typeof this.type)throw new TypeError("LocalSocket: EventRecord: Invalid event type: "+this.type);if(this.key=o,"string"!=typeof this.key)throw new TypeError("LocalSocket: EventRecord: Invalid event key: "+this.key);if(this.value=i,"object"!=typeof this.value||!this.value)throw new TypeError("LocalSocket: EventRecord: Invalid event value: "+this.value);if(this.date=a,"number"!=typeof this.date||this.date>=0==!1)throw new TypeError("LocalSocket: EventRecord: Invalid event date: "+this.date);if(this.attr=this.type===t.EventType.put?Object.keys(i).reduce(function(e,t){return t.length>0&&"_"!==t[0]&&"_"!==t[t.length-1]?t:e},""):"","string"!=typeof this.attr)throw new TypeError("LocalSocket: EventRecord: Invalid event attr: "+this.key);if(this.type===t.EventType.put&&0===this.attr.length)throw new TypeError("LocalSocket: EventRecord: Invalid event attr with "+this.type+": "+this.attr);if(this.type!==t.EventType.put&&0!==this.attr.length)throw new TypeError("LocalSocket: EventRecord: Invalid event attr with "+this.type+": "+this.attr);switch(s){case t.EventType.put:return this.value=i=n.clone(new r,(c={},c[this.attr]=i[this.attr],c)),void void Object.freeze(this.value);case t.EventType.snapshot:return this.value=i=n.clone(new r,i),void void Object.freeze(this.value);case t.EventType["delete"]:return this.value=i=new r,void void Object.freeze(this.value);default:throw new TypeError("LocalSocket: Invalid event type: "+s)}var c}return e}();t.EventRecord=o}),define("src/layer/data/store/event",["require","exports","spica","src/layer/infrastructure/indexeddb/api","src/layer/data/constraint/types","src/layer/data/schema/event","src/lib/noop"],function(e,t,n,r,o,i,a){"use strict";function s(e){function t(e){return e.map(function(e,t){return[e,t]}).sort(function(e,t){var n=e[0],r=e[1],o=t[0],i=t[1];return indexedDB.cmp(n.key,o.key)||o.date-n.date||i-r}).reduceRight(function(e,t){var r=e[0],o=e.slice(1),i=t[0],a=r[0];return a?a.key===i.key?n.concat([n.concat([i],r)],o):n.concat([[i]],n.concat([r],o)):[[i]]},[[]])}function r(e,t){switch(t.type){case i.EventType.put:return void 0!==t.value[t.attr]?new c(t.key,n.assign(new i.EventValue,e.value,t.value),i.EventType.snapshot):new c(t.key,Object.keys(e.value).reduce(function(n,r){return r===t.attr?n:(n[r]=e[r],n)},new i.EventValue),i.EventType.snapshot);case i.EventType.snapshot:return t;case i.EventType["delete"]:return t}throw new TypeError("LocalSocket: Invalid event type: "+t.type)}return t(e).map(function(e){return e.reduceRight(r,new c(o.KeyString(""),new i.EventValue,i.EventType["delete"],0))})}t.EventType=i.EventType,t.EventValue=i.EventValue;var c=function(e){function t(t,n,r,o){if(void 0===r&&(r=i.EventType.put),void 0===o&&(o=Date.now()),e.call(this,void 0,t,n,o,r),void 0!==this.id||"id"in this)throw new TypeError("LocalSocket: UnsavedEventRecord: Invalid event id: "+this.id)}return __extends(t,e),t}(i.EventRecord);t.UnsavedEventRecord=c;var d=function(e){function t(t,n,r,o,i){if(e.call(this,t,n,r,i,o),this.id=t,this.id>0==!1)throw new TypeError("LocalSocket: SavedEventRecord: Invalid event id: "+this.id);void Object.freeze(this)}return __extends(t,e),t}(i.EventRecord);t.SavedEventRecord=d,t.ESEventType={put:"put","delete":"delete",snapshot:"snapshot"};var u=function(){function e(e,t,n,r){this.type=e,this.id=t,this.key=n,this.attr=r,void Object.freeze(this)}return e}();t.ESEvent=u;var v={put:"put","delete":"delete",snapshot:"snapshot",query:"query"},y=function(){function e(e,t,n,r){this.type=e,this.id=t,this.key=n,this.attr=r,void Object.freeze(this)}return e}(),f={id:"id",key:"key",type:"type",attr:"attr",value:"value",date:"date",surrogateKeyDateField:"key+date"},p=function(){function e(e,t){var r=this;this.database=e,this.name=t,this.cache=new(function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(n.Supervisor)),this.events={load:new n.Observable,save:new n.Observable,loss:new n.Observable},this.events_={access:new n.Observable},this.syncState=new Map,this.syncWaits=new n.Observable,this.snapshotCycle=10,this.snapshotJobState=new Map;var o=new Map,i=new Map;void this.cache.events.exec.monitor([],function(e){var t=e[1],n=t(void 0);if(n instanceof d!=!1){var a=function(){return!o.has(n.key)||n.id>o.get(n.key)},s=function(){return!i.has(n.key)||n.date>i.get(n.key)&&n.date>r.cache.cast([n.key],void 0).filter(function(e){return e!==n}).reduce(function(e,t){return t.date>e?t.date:e},0)};a()&&s()&&(void o.set(n.key,n.id),void i.set(n.key,n.date),void r.events.load.emit([n.key,n.attr,n.type],new u(n.type,n.id,n.key,n.attr)))}}),void this.cache.events.exec.monitor([],function(e){var t=e[1],n=t(void 0);(!o.has(n.key)||o.get(n.key)<n.id)&&void o.set(n.key,n.id),(!i.has(n.key)||i.get(n.key)<n.date)&&void i.set(n.key,n.date)})}return e.configure=function(e){return{make:function(t){var n=t.objectStoreNames.contains(e)?t.transaction(e).objectStore(e):t.createObjectStore(e,{keyPath:f.id,autoIncrement:!0});return n.indexNames.contains(f.id)||void n.createIndex(f.id,f.id,{unique:!0}),n.indexNames.contains(f.key)||void n.createIndex(f.key,f.key),n.indexNames.contains(f.type)||void n.createIndex(f.type,f.type),n.indexNames.contains(f.attr)||void n.createIndex(f.attr,f.attr),n.indexNames.contains(f.value)||void n.createIndex(f.value,f.value),n.indexNames.contains(f.date)||void n.createIndex(f.date,f.date),n.indexNames.contains(f.surrogateKeyDateField)||void n.createIndex(f.surrogateKeyDateField,[f.key,f.date]),!0},verify:function(t){return t.objectStoreNames.contains(e)&&t.transaction(e).objectStore(e).indexNames.contains(f.id)&&t.transaction(e).objectStore(e).indexNames.contains(f.key)&&t.transaction(e).objectStore(e).indexNames.contains(f.type)&&t.transaction(e).objectStore(e).indexNames.contains(f.attr)&&t.transaction(e).objectStore(e).indexNames.contains(f.value)&&t.transaction(e).objectStore(e).indexNames.contains(f.date)&&t.transaction(e).objectStore(e).indexNames.contains(f.surrogateKeyDateField)},destroy:function(){return!0}}},e.prototype.sync=function(e,t,n){var r=this;return void 0===t&&(t=a.noop),void 0===n&&(n=0),void e.map(function(e){switch(r.syncState.get(e)){case!0:return new Promise(function(t){return void t([e,null])});case!1:return t===a.noop?new Promise(function(t){return void t([e,null])}):new Promise(function(t){return n>0?(void r.get(e),void void setTimeout(function(){return t([e,new Error])})):void 0,void void r.syncWaits.once([e],function(n){return void t([e,n])})});default:return void r.update(e),t===a.noop?new Promise(function(t){return void t([e,null])}):new Promise(function(t){return n>0?(void r.get(e),void void setTimeout(function(){return t([e,new Error])})):void 0,void void r.syncWaits.once([e],function(n){return void t([e,n])})})}}).reduce(function(e,t){return e.then(function(e){return t.then(function(t){return e.concat([t])})})},new Promise(function(e){return void e([])})).then(function(e){return void t(e.filter(function(e){return!!e[1]}))})},e.prototype.update=function(e){var t=this,o=this.meta(e),a=[];return void this.syncState.set(e,this.syncState.get(e)===!0),void this.cursor(e,f.key,r.IDBCursorDirection.prev,r.IDBTransaction.readonly,function(r,c){if(c)return void t.syncWaits.emit([e],c);if(!r||r.value.id<=o.id)return s(a).reduce(function(e){return e}).type===i.EventType["delete"]?void t.clean(1/0,e):(void a.reduceRight(function(e,t){return e.some(function(e){var n=e.attr;return n===t.attr})?e:n.concat([t],e)},[]).reduce(function(e,t){switch(t.type){case i.EventType.put:return n.concat([t],e);default:return[t]}},[]).reduce(function(e,r){void t.cache.terminate([r.key,r.attr,n.sqid(r.id)]),void t.cache.register([r.key,r.attr,n.sqid(r.id)],function(e){return r})},void 0),void t.cache.cast([e],void 0)),void t.syncState.set(e,!0),void t.syncWaits.emit([e],void 0),void(a.length>t.snapshotCycle&&void t.snapshot(e));var u=r.value;t.cache.refs([u.key,u.attr,n.sqid(u.id)]).length>0||(void a.unshift(new d(u.id,u.key,u.value,u.type,u.date)),u.type===i.EventType.put&&void r["continue"]())})},e.prototype.meta=function(e){var t=this.cache.cast([e],void 0);return Object.freeze(n.clone({id:t.reduce(function(e,t){return t.id>e?t.id:e},0),date:0},s(t).reduce(function(e){return e}),{key:e}))},e.prototype.keys=function(){return this.cache.cast([],void 0).reduce(function(e,t){return 0===e.length||e[e.length-1]!==t.key?n.concat(e,[t.key]):e},[]).sort()},e.prototype.has=function(e){return s(this.cache.cast([e],void 0)).reduce(function(e){return e}).type!==i.EventType["delete"]},e.prototype.get=function(e){return void this.sync([e]),void this.events_.access.emit([e],new y(v.query,o.IdNumber(0),e,"")),s(this.cache.cast([e],void 0)).reduce(function(e){return e}).value},e.prototype.add=function(e){var t=this;if(void this.events_.access.emit([e.key,e.attr,e.type],new y(e.type,o.IdNumber(0),e.key,e.attr)),e instanceof c==!1)throw new Error("LocalSocket: Cannot add a saved event: "+JSON.stringify(e));void this.sync([e.key]);var a=n.sqid();return void this.cache.register([e.key,e.attr,n.sqid(0),a],function(t){return e}),void this.cache.cast([e.key,e.attr,n.sqid(0),a],void 0),void r.listen(this.database)(function(s){if(0!==t.cache.refs([e.key,e.attr,n.sqid(0)]).length){var c=s.transaction(t.name,r.IDBTransaction.readwrite),v=c.objectStore(t.name).add(e);c.oncomplete=function(r){var s=new d(o.IdNumber(v.result),e.key,e.value,e.type,e.date);void t.cache.terminate([s.key,s.attr,n.sqid(0),a]),void t.cache.register([s.key,s.attr,n.sqid(s.id)],function(e){return s}),void t.events.save.emit([s.key,s.attr,s.type],new u(s.type,s.id,s.key,s.attr)),void t.cache.cast([s.key,s.attr,n.sqid(s.id)],void 0),t.cache.refs([e.key]).filter(function(e){var t=e[1];return t(void 0)instanceof d}).length>t.snapshotCycle?void t.snapshot(e.key):s.type===i.EventType["delete"]&&void t.clean(1/0,s.key)},c.onerror=c.onabort=function(r){void setTimeout(function(){0!==t.cache.refs([e.key,e.attr,n.sqid(0),a]).length&&void t.events.loss.emit([e.key,e.attr,e.type],new u(e.type,e.id,e.key,e.attr))},1e3)}}})},e.prototype["delete"]=function(e){return void this.add(new c(e,new i.EventValue,i.EventType["delete"]))},e.prototype.snapshot=function(e){var t=this;if(!this.snapshotJobState.get(e))return void this.snapshotJobState.set(e,!0),void r.listen(this.database)(function(n){var o=n.transaction(t.name,r.IDBTransaction.readwrite),a=o.objectStore(t.name),u=a.index(f.key).openCursor(e,r.IDBCursorDirection.prev),v=[];u.onsuccess=function(n){var r=u.result;if(r){var o=r.value;void v.unshift(new d(o.id,o.key,o.value,o.type,o.date))}if(!r||r.value.type!==i.EventType.put){if(v.length<t.snapshotCycle)return;void t.clean(1/0,e);var y=s(v).reduce(function(e){return e});if(y instanceof d)return;switch(y.type){case i.EventType.snapshot:return void a.add(new c(y.key,y.value,y.type,v.reduce(function(e,t){return t.date>e?t.date:e},0)));case i.EventType["delete"]:return}throw new TypeError("LocalSocket: Invalid event type: "+y.type)}void r["continue"]()},o.oncomplete=function(n){void t.snapshotJobState.set(e,!1),void t.update(e)},o.onerror=o.onabort=function(n){void t.snapshotJobState.set(e,!1)}})},e.prototype.clean=function(e,t){var o=this;void 0===e&&(e=1/0);var a=[],s=new Map;return void this.cursor(t?r.IDBKeyRange.bound([t,0],[t,e]):r.IDBKeyRange.upperBound(e),t?f.surrogateKeyDateField:f.date,r.IDBCursorDirection.prev,r.IDBTransaction.readwrite,function(e,t){if(!e)return void a.reduce(function(e,t){return void o.cache.terminate([t.key,t.attr,n.sqid(t.id)])},void 0);var r=e.value;switch(r.type){case i.EventType.put:void s.set(r.key,s.get(r.key)||!1);break;case i.EventType.snapshot:if(!s.get(r.key))return void s.set(r.key,!0),void void e["continue"]();break;case i.EventType["delete"]:void s.set(r.key,!0);break;default:void s.set(r.key,!0)}s.get(r.key)&&(void e["delete"](),void a.unshift(r)),void e["continue"]()})},e.prototype.cursor=function(e,t,n,o,i){var a=this;return void r.listen(this.database)(function(r){var s=r.transaction(a.name,o),c=t?s.objectStore(a.name).index(t).openCursor(e,n):s.objectStore(a.name).openCursor(e,n);c.onsuccess=function(e){return c.result&&i(c.result,c.error)},s.oncomplete=function(e){return void i(null,s.error)},s.onerror=s.onabort=function(e){return void i(null,s.error)}})},e}();t.AbstractEventStore=p,t.compose=s}),define("src/layer/domain/indexeddb/model/socket/data",["require","exports","src/layer/data/store/event"],function(e,t,n){"use strict";t.STORE_NAME="data",t.STORE_FIELDS={key:"key"};var r=function(){function e(){}return e}();t.DataValue=r;var o=function(e){function r(n){e.call(this,n,t.STORE_NAME),void Object.freeze(this)}return __extends(r,e),r.configure=function(){return n.AbstractEventStore.configure(t.STORE_NAME)},r}(n.AbstractEventStore);t.DataStore=o}),define("src/layer/data/store/key-value",["require","exports","spica","src/layer/infrastructure/indexeddb/api","src/lib/noop"],function(e,t,n,r,o){"use strict";t.EventType={get:"get",put:"put","delete":"delete"};var i=function(){function e(e,t,r){if(this.database=e,this.name=t,this.index=r,this.cache=new Map,this.events={access:new n.Observable},"string"!=typeof r)throw new TypeError}return e.configure=function(){return{make:function(){return!0},verify:function(){return!0},destroy:function(){return!0}}},e.prototype.get=function(e,n){var i=this;return void 0===n&&(n=o.noop),void this.events.access.emit([e],[[e],t.EventType.get]),void r.listen(this.database)(function(t){var o,a=t.transaction(i.name,r.IDBTransaction.readonly),s=i.index?a.objectStore(i.name).index(i.index).get(e):a.objectStore(i.name).get(e);s.onsuccess=function(t){return o=void 0!==s.result&&null!==s.result?s.result:i.cache.get(e)},a.oncomplete=function(e){return n(o,a.error)},a.onerror=a.onabort=function(e){return n(void 0,a.error)}}),this.cache.get(e)},e.prototype.set=function(e,t,n){return void 0===n&&(n=o.noop),this.put(t,e,n)},e.prototype.put=function(e,n,i){var a=this;return void 0===i&&(i=o.noop),void this.cache.set(n,e),void this.events.access.emit([n],[[n],t.EventType.put]),void r.listen(this.database)(function(e){if(a.cache.has(n)){var t=e.transaction(a.name,r.IDBTransaction.readwrite);a.index?t.objectStore(a.name).put(a.cache.get(n)):t.objectStore(a.name).put(a.cache.get(n),n);t.oncomplete=t.onerror=t.onabort=function(e){return void i(n,t.error)}}}),this.cache.get(n)},e.prototype["delete"]=function(e,n){var i=this;void 0===n&&(n=o.noop),void this.cache["delete"](e),void this.events.access.emit([e],[[e],t.EventType["delete"]]),void r.listen(this.database)(function(t){var o=t.transaction(i.name,r.IDBTransaction.readwrite);o.objectStore(i.name)["delete"](e);o.oncomplete=o.onerror=o.onabort=function(e){return void n(o.error)}})},e.prototype.cursor=function(e,t,n,o,i){var a=this;void r.listen(this.database)(function(r){var s=r.transaction(a.name,o),c=t?s.objectStore(a.name).index(t).openCursor(e,n):s.objectStore(a.name).openCursor(e,n);c.onsuccess=function(e){return c.result&&i(c.result,c.error)},s.oncomplete=function(e){return void i(null,s.error)},s.onerror=s.onabort=function(e){return void i(null,s.error)}})},e}();t.AbstractKeyValueStore=i}),define("src/layer/domain/indexeddb/model/socket/access",["require","exports","src/layer/data/store/key-value","src/layer/data/store/event"],function(e,t,n,r){"use strict";t.STORE_NAME="access",t.STORE_FIELDS={key:"key",date:"date"};var o=function(){function e(e,t){this.key=e,this.date=t}return e}(),i=function(e){function n(n,i){var a=this;e.call(this,n,t.STORE_NAME,t.STORE_FIELDS.key),void Object.freeze(this),void i.monitor([],function(e){var t=e.key,n=e.type;return n===r.ESEventType["delete"]?void a["delete"](t):void a.set(t,new o(t,Date.now()))})}return __extends(n,e),n.configure=function(){return{make:function(e){var n=e.objectStoreNames.contains(t.STORE_NAME)?e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME):e.createObjectStore(t.STORE_NAME,{keyPath:t.STORE_FIELDS.key,autoIncrement:!1});return n.indexNames.contains(t.STORE_FIELDS.key)||void n.createIndex(t.STORE_FIELDS.key,t.STORE_FIELDS.key,{unique:!0}),n.indexNames.contains(t.STORE_FIELDS.date)||void n.createIndex(t.STORE_FIELDS.date,t.STORE_FIELDS.date),!0},verify:function(e){return e.objectStoreNames.contains(t.STORE_NAME)&&e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME).indexNames.contains(t.STORE_FIELDS.key)&&e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME).indexNames.contains(t.STORE_FIELDS.date)},destroy:function(){return!0}}},n}(n.AbstractKeyValueStore);t.AccessStore=i}),define("src/layer/domain/indexeddb/model/socket/expiry",["require","exports","src/layer/infrastructure/indexeddb/api","src/layer/data/store/key-value","src/layer/data/store/event"],function(e,t,n,r,o){"use strict";t.STORE_NAME="expiry",t.STORE_FIELDS={key:"key",expiry:"expiry"};var i=function(){function e(e,t){this.key=e,this.expiry=t}return e}(),a=function(e){function r(r,a,s,c){var d=this;e.call(this,r,t.STORE_NAME,t.STORE_FIELDS.key),void Object.freeze(this);var u=0,v=1/0,y=function(e){e>v||(void clearTimeout(u),v=e,u=setTimeout(function(){v=1/0,void d.cursor(null,t.STORE_FIELDS.expiry,n.IDBCursorDirection.next,n.IDBTransaction.readonly,function(e){if(e){var t=e.value;t.expiry>Date.now()?void y(t.expiry):(void a["delete"](t.key),void e["continue"]())}})},e-Date.now()),void n.event.once([r,n.IDBEventType.destroy],function(){return void clearTimeout(u)}))};void y(Date.now()),void s.events_.access.monitor([],function(e){var t=e.key,n=e.type;if(n===o.ESEventType["delete"])void d["delete"](t);else{if(!c.has(t))return;var r=Date.now()+c.get(t);void d.set(t,new i(t,r)),void y(r)}})}return __extends(r,e),r.configure=function(){return{make:function(e){var n=e.objectStoreNames.contains(t.STORE_NAME)?e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME):e.createObjectStore(t.STORE_NAME,{keyPath:t.STORE_FIELDS.key,autoIncrement:!1});return n.indexNames.contains(t.STORE_FIELDS.key)||void n.createIndex(t.STORE_FIELDS.key,t.STORE_FIELDS.key,{unique:!0}),n.indexNames.contains(t.STORE_FIELDS.expiry)||void n.createIndex(t.STORE_FIELDS.expiry,t.STORE_FIELDS.expiry),!0},verify:function(e){return e.objectStoreNames.contains(t.STORE_NAME)&&e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME).indexNames.contains(t.STORE_FIELDS.key)&&e.transaction(t.STORE_NAME).objectStore(t.STORE_NAME).indexNames.contains(t.STORE_FIELDS.expiry)},destroy:function(){return!0}}},r}(r.AbstractKeyValueStore);t.ExpiryStore=a}),define("src/layer/domain/indexeddb/model/socket",["require","exports","spica","src/layer/infrastructure/indexeddb/api","src/layer/data/constraint/types","src/layer/data/store/event","src/layer/domain/indexeddb/model/socket/data","src/layer/domain/indexeddb/model/socket/access","src/layer/domain/indexeddb/model/socket/expiry","src/lib/noop"],function(e,t,n,r,o,i,a,s,c,d){"use strict";t.SocketRecord=i.UnsavedEventRecord,t.ESEventType=i.ESEventType,t.SocketValue=a.DataValue;var u=function(){function e(e,t,o){var i=this;void 0===o&&(o=1/0),this.database=e,this.expiry=o,this.uuid=n.uuid(),this.events={load:new n.Observable,save:new n.Observable,loss:new n.Observable},this.expiries=new Map,void r.open(e,{make:function(e){return a.DataStore.configure().make(e)&&s.AccessStore.configure().make(e)&&c.ExpiryStore.configure().make(e)},verify:function(e){return a.DataStore.configure().verify(e)&&s.AccessStore.configure().verify(e)&&c.ExpiryStore.configure().verify(e)},destroy:function(e,n){return a.DataStore.configure().destroy(e,n)&&s.AccessStore.configure().destroy(e,n)&&c.ExpiryStore.configure().destroy(e,n)&&t(e,n)}}),this.schema=new v(this,this.expiries),void r.event.on([e,r.IDBEventType.destroy,this.uuid],function(){
return void i.schema.bind()})}return e.prototype.sync=function(e,t,n){return void 0===t&&(t=d.noop),this.schema.data.sync(e,t,n)},e.prototype.meta=function(e){return this.schema.data.meta(o.KeyString(e))},e.prototype.has=function(e){return this.schema.data.has(o.KeyString(e))},e.prototype.get=function(e){return this.schema.data.get(o.KeyString(e))},e.prototype.add=function(e){return this.schema.data.add(e)},e.prototype["delete"]=function(e){return this.schema.data["delete"](o.KeyString(e))},e.prototype.expire=function(e,t){return void 0===t&&(t=this.expiry),t!==1/0?void this.expiries.set(e,t):void 0},e.prototype.recent=function(e,t){var n=[];return void this.schema.access.cursor(null,s.STORE_FIELDS.date,r.IDBCursorDirection.prevunique,r.IDBTransaction.readonly,function(r,o){return r?void(--e<0||(void n.push(r.primaryKey),void r["continue"]())):void t(n,o)})},e.prototype.destroy=function(){return void r.event.off([this.database,r.IDBEventType.destroy,this.uuid]),r.destroy(this.database)},e}();t.SocketStore=u;var v=function(){function e(e,t){this.store_=e,this.expiries_=t,void this.bind()}return e.prototype.bind=function(){var e=this,t=this.data?this.data.keys():[];this.data=new a.DataStore(this.store_.database),this.data.events.load.monitor([],function(t){return e.store_.events.load.emit([t.key,t.attr,t.type],t)}),this.data.events.save.monitor([],function(t){return e.store_.events.save.emit([t.key,t.attr,t.type],t)}),this.data.events.loss.monitor([],function(t){return e.store_.events.loss.emit([t.key,t.attr,t.type],t)}),this.access=new s.AccessStore(this.store_.database,this.data.events_.access),this.expire=new c.ExpiryStore(this.store_.database,this.store_,this.data,this.expiries_),void this.data.sync(t)},e}()}),define("src/layer/domain/webstorage/service/event",["require","exports","spica","src/layer/infrastructure/webstorage/api"],function(e,t,n,r){"use strict";function o(e){var t=new n.Observable;return void e.on(["storage"],function(e){return void t.emit([e.key],e)}),t}t.events={localStorage:o(r.events.localStorage),sessionStorage:o(r.events.sessionStorage)}}),define("src/layer/domain/webstorage/service/storage",["require","exports"],function(e,t){"use strict";var n=function(){function e(){this.store=new Map}return Object.defineProperty(e.prototype,"length",{get:function(){return this.store.size},enumerable:!0,configurable:!0}),e.prototype.getItem=function(e){return this.store.has(e)?this.store.get(e):null},e.prototype.setItem=function(e,t){void this.store.set(e,t)},e.prototype.removeItem=function(e){void this.store["delete"](e)},e.prototype.clear=function(){void this.store.clear()},e}();t.fakeStorage=new n}),define("src/layer/domain/webstorage/repository/port",["require","exports","spica","src/layer/domain/dao/api","src/layer/domain/webstorage/service/event","src/layer/infrastructure/webstorage/api","src/layer/domain/webstorage/service/storage"],function(e,t,n,r,o,i,a){"use strict";function s(e,t,n,r){return void 0===t&&(t=i.sessionStorage||a.fakeStorage),void 0===r&&(r={update:function(e){},"delete":function(e){}}),new y(e,t,n,r)}var c,d=new Map,u=(new Map,new Map);new Map;!function(e){e.send="send",e.recv="recv"}(c=t.PortEventType||(t.PortEventType={}));var v=function(){function e(e,t,n,r,o){this.type=e,this.key=t,this.attr=n,this.newValue=r,this.oldValue=o}return e}();t.PortEvent=v,t.repository=s;var y=function(){function e(e,t,r,a){void 0===a&&(a={update:function(e){},"delete":function(e){}}),this.name=e,this.storage=t,this.factory=r,this.log=a,this.cache=this.storage===i.localStorage?d:u,this.eventSource=this.storage===i.localStorage?o.events.localStorage:o.events.sessionStorage,this.uuid=n.uuid(),this.events={send:new n.Observable,recv:new n.Observable},void Object.freeze(this)}return e.prototype.link=function(){function e(e){try{return JSON.parse(e)||{}}catch(t){return{}}}var t=this;if(this.cache.has(this.name))return this.cache.get(this.name);var o=n.assign((s={},s[r.SCHEMA.KEY.NAME]=this.name,s[r.SCHEMA.EVENT.NAME]=new n.Observable,s),e(this.storage.getItem(this.name))),i=r.build(o,this.factory,function(e,n,i){void t.log.update(t.name),void t.storage.setItem(t.name,JSON.stringify(Object.keys(o).filter(r.isValidPropertyName).filter(r.isValidPropertyValue(o)).reduce(function(e,t){return e[t]=o[t],e},{})));var a=new v(c.send,t.name,e,n,i);void o.__event.emit([a.type,a.attr],a),void t.events.send.emit([a.attr],a)}),a=function(n){var i=n.newValue,a=e(i);void Object.keys(a).filter(r.isValidPropertyName).filter(r.isValidPropertyValue(a)).reduce(function(e,n){var r=o[n],i=a[n];if(i!==r){o[n]=i;var s=new v(c.recv,t.name,n,i,r);void o.__event.emit([s.type,s.attr],s),void t.events.recv.emit([s.attr],s)}},void 0)};return void this.eventSource.on([this.name,this.uuid],a),void this.cache.set(this.name,i),void this.log.update(this.name),i;var s},e.prototype.destroy=function(){void this.eventSource.off([this.name,this.uuid]),void this.cache["delete"](this.name),void this.storage.removeItem(this.name),void this.log["delete"](this.name)},e}()}),define("src/layer/domain/webstorage/api",["require","exports","src/layer/domain/webstorage/repository/port","src/layer/infrastructure/webstorage/api","src/layer/domain/webstorage/service/event","src/layer/domain/webstorage/repository/port"],function(e,t,n,r,o,i){"use strict";function a(e,t,r){return n.repository(e,t,r)}t.localStorage=r.localStorage,t.sessionStorage=r.sessionStorage,t.supportWebStorage=r.supportWebStorage,t.events=o.events,t.WebStorageEvent=i.PortEvent,t.WebStorageEventType=i.PortEventType,t.webstorage=a}),define("src/layer/domain/indexeddb/repository/socket",["require","exports","spica","src/layer/domain/dao/api","src/layer/domain/indexeddb/model/socket","src/layer/infrastructure/webstorage/api","src/layer/domain/webstorage/api","src/layer/data/constraint/types"],function(e,t,n,r,o,i,a,s){"use strict";function c(e,t,n,r){return void 0===r&&(r=1/0),new v(e,t,r,n)}t.socket=c;var d=function(){function e(e,t,n){this.key=e,this.attr=t,this.date=n}return e}(),u=function(){function e(){this.msgs=[],this.msgHeadSet_=new Map}return e.prototype.recv=function(){var e=this;return this.msgs.map(function(e){return new d(e.key,e.attr,e.date)}).filter(function(t){return!e.msgHeadSet_.has(t.key)||t.date>e.msgHeadSet_.get(t.key)}).filter(function(t){return!void e.msgHeadSet_.set(t.key,t.date)})},e.prototype.send=function(e){this.msgs=n.concat([e],this.msgs.slice(0,9))},e}(),v=function(e){function t(t,n,s,c){var v=this;e.call(this,t,c,s),this.factory=n,this.proxy=a.webstorage(this.database,i.localStorage,function(){return new u}),this.port=this.proxy.link(),this.links=new Map,this.sources=new Map,void this.port.__event.on([a.WebStorageEventType.recv,"msgs"],function(){void v.port.recv().reduce(function(e,t){return void v.schema.data.update(t.key)},void 0)}),void this.events.save.monitor([],function(e){var t=(e.id,e.key),n=e.attr;void v.port.send(new d(t,n,Date.now()))}),void this.events.load.monitor([],function(e){var t=(e.id,e.key),n=e.attr,i=e.type,s=v.sources.get(t);if(s)switch(i){case o.ESEventType.put:var c=s[n],d=v.get(t)[n];return s[n]=d,void void s.__event.emit([a.WebStorageEventType.recv,n],new a.WebStorageEvent(a.WebStorageEventType.recv,t,n,d,c));case o.ESEventType["delete"]:var u=v.get(t);return void void Object.keys(u).filter(r.isValidPropertyName).filter(r.isValidPropertyValue(u)).sort().reduce(function(e,n){var r=s[n],o=void 0;s[n]=o,void s.__event.emit([a.WebStorageEventType.recv,n],new a.WebStorageEvent(a.WebStorageEventType.recv,t,n,o,r))},void 0);case o.ESEventType.snapshot:var y=v.get(t);return void void Object.keys(y).filter(r.isValidPropertyName).filter(r.isValidPropertyValue(y)).sort().reduce(function(e,n){var r=s[n],o=y[n];s[n]=o,void s.__event.emit([a.WebStorageEventType.recv,n],new a.WebStorageEvent(a.WebStorageEventType.recv,t,n,o,r))},void 0)}}),void Object.freeze(this)}return __extends(t,e),t.prototype.link=function(e,t){var i=this;return void this.expire(e,t),this.links.has(e)?this.links.get(e):this.links.set(e,r.build(Object.defineProperties((void this.sources.set(e,n.clone({},this.get(e))),this.sources.get(e)),{__meta:{get:function(){return i.meta(e)}},__id:{get:function(){return this.__meta.id}},__key:{get:function(){return this.__meta.key}},__date:{get:function(){return this.__meta.date}},__event:{value:new n.Observable}}),this.factory,function(t,n,r){void i.add(new o.SocketRecord(s.KeyString(e),(c={},c[t]=n,c))),void i.sources.get(e).__event.emit([a.WebStorageEventType.send,t],new a.WebStorageEvent(a.WebStorageEventType.send,e,t,n,r));var c})).get(e)},t.prototype.destroy=function(){void this.proxy.destroy(),void e.prototype.destroy.call(this)},t}(o.SocketStore)}),define("src/layer/domain/indexeddb/service/event",["require","exports","src/layer/infrastructure/indexeddb/api"],function(e,t,n){"use strict";t.event=n.event,t.IDBEventType=n.IDBEventType}),define("src/layer/domain/indexeddb/api",["require","exports","src/layer/domain/indexeddb/repository/socket","src/layer/domain/indexeddb/service/event"],function(e,t,n,r){"use strict";t.socket=n.socket,t.event=r.event,t.IDBEventType=r.IDBEventType}),define("src/layer/app/api",["require","exports","src/layer/domain/indexeddb/api","src/layer/domain/webstorage/api","src/layer/domain/indexeddb/api","src/layer/domain/webstorage/api","src/layer/domain/webstorage/api"],function(e,t,n,r,o,i,a){"use strict";function s(e,t){function r(e){var t=function(){function e(e,t,n){void 0===t&&(t=1/0),void 0===n&&(n=function(){return!0}),this.schema=e,this.expiry=t,this.destroy=n,void Object.freeze(this)}return e}();return new t(e.schema,e.expiry,e.destroy)}return t=r(t),n.socket(e,t.schema,t.destroy,t.expiry)}function c(e,t){function n(e){var t=function(){function e(e,t){void 0===t&&(t=function(){return!0}),this.schema=e,this.destroy=t,void Object.freeze(this)}return e}();return new t(e.schema,e.destroy)}return t=n(t),r.webstorage(e,r.localStorage,t.schema)}t.status=a.supportWebStorage,t.socket=s,t.port=c;var d;!function(e){e.indexedDB=o.event,e.localStorage=i.events.localStorage,e.sessionStorage=i.events.sessionStorage}(d=t.events||(t.events={}))}),define("src/layer/interface/api",["require","exports","src/layer/app/api"],function(e,t,n){"use strict";t.socket=n.socket,t.port=n.port,t.events=n.events,t.status=n.status}),define("src/export",["require","exports","src/layer/interface/api"],function(e,t,n){"use strict";t["default"]=n.socket,t.socket=n.socket,t.port=n.port,t.status=n.status}),define("localsocket",["require","exports","src/export","src/export"],function(e,t,n,r){"use strict";function o(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}o(n),t["default"]=r["default"]});